#!/bin/sh

# UQCS testing slack tokens (split in two to avoid magic slack detection)
prefix=xoxb-
token_0=260143289456-v37huSMLBqcWPxLYua2bWDsU
token_1=260850095972-qpQeBegFUhTlqYbzZdPMGv3v
token_2=260936998101-SfKZgBU1FlpPhy43KttJ5cmO
token_3=261681938550-e3XzaBtZJJzQVmLieTn8QX1S


set -e

export PATH="node_modules/.bin:node_modules/hubot/node_modules/.bin:$PATH"

if [ $# -eq 3 ] && [ "$1" = "--adapter" ] && [ "$2" = "slack" ]; then
    index=$3
    if [ $index -gt 3 ] || [ $index -lt 0 ]; then
        echo "Slack token selection must be in the range of 0-3"
    else
        if [ $index -eq 0 ]; then
            export HUBOT_SLACK_TOKEN=$prefix$token_0
        fi
        if [ $index -eq 1 ]; then
            export HUBOT_SLACK_TOKEN=$prefix$token_1
        fi
        if [ $index -eq 2 ]; then
            export HUBOT_SLACK_TOKEN=$prefix$token_2
        fi
        if [ $index -eq 3 ]; then
            export HUBOT_SLACK_TOKEN=$prefix$token_3
        fi

        exec node_modules/.bin/hubot --name "uqcsbot" --alias "!" $1 $2
    fi
else
    exec node_modules/.bin/hubot --name "uqcsbot" --alias "!" "$@"
fi
